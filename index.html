<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Context - Study Lyrics & Texts</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='2' y='12' font-size='12' fill='%23333'>T</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <button id="titleBtn" class="title-button">Text Annotator</button>
            <div class="header-controls">
                <!-- Guest user controls -->
                <div id="guestControls" class="control-group">
                    <button id="loginBtn" class="btn btn-secondary">Login</button>
                    <button id="registerBtn" class="btn btn-accent">Sign Up</button>
                </div>
                
                <!-- Authenticated user controls -->
                <div id="userControls" class="control-group" style="display: none;">
                    <button id="exportBtn" class="btn btn-secondary" style="display: none;">Export</button>
                    <input type="file" id="importBtn" accept=".txt,.pdf,.json" style="display: none;">
                    <button onclick="document.getElementById('importBtn').click()" class="btn btn-secondary">Import</button>
                    <button id="saveBtn" class="btn btn-primary" style="display: none;">Save</button>
                    <button id="accountBtn" class="btn btn-account" title="Account">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Document Dashboard -->
            <div id="documentDashboard" class="document-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h2>My Documents</h2>
                    <button id="newDocumentBtn" class="btn btn-primary">
                        <span class="plus-icon">+</span>
                        New Document
                    </button>
                </div>
                
                <div class="documents-grid" id="documentsGrid">
                    <div class="document-card new-document" id="newDocumentCard">
                        <div class="document-content">
                            <div class="document-icon">+</div>
                            <h3>Create New Document</h3>
                            <p>Start a new text for annotations</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Editor (existing) -->
            <div id="editorView" class="editor-view">
                <div class="editor-container">
                                    <div class="editor-toolbar">
                    <div class="toolbar-left">
                        <button id="backToDashboardBtn" class="btn btn-secondary" style="display: none;">
                            ‚Üê Back to Documents
                        </button>
                        <input type="text" id="documentTitle" class="document-title-input" placeholder="Document Title" style="display: none;">
                    </div>
                    <div class="toolbar-right">
                        <span class="toolbar-info">Select text to add context annotations</span>
                        <button id="addContextBtn" class="btn btn-accent" disabled>Add Context</button>
                    </div>
                </div>
                
                <!-- Rich Text Formatting Toolbar -->
                <div class="formatting-toolbar">
                    <div class="toolbar-group">
                        <select id="fontFamily" class="format-select" title="Font Family">
                            <option value="Inter">Inter</option>
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Verdana">Verdana</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                        </select>

                    </div>
                    
                    <div class="toolbar-group">
                        <button id="boldBtn" class="format-btn" title="Bold (Ctrl+B)">
                            <strong>B</strong>
                        </button>
                        <button id="italicBtn" class="format-btn" title="Italic (Ctrl+I)">
                            <em>I</em>
                        </button>
                        <button id="underlineBtn" class="format-btn" title="Underline (Ctrl+U)">
                            <u>U</u>
                        </button>
                        <button id="strikeBtn" class="format-btn" title="Strikethrough">
                            <s>S</s>
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button id="textColorBtn" class="format-btn color-btn" title="Text Color">
                            <span id="textColorIcon" class="color-icon" style="color: #1e293b;">A</span>
                            <input type="color" id="textColor" class="hidden-color-picker" value="#1e293b">
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button id="alignLeftBtn" class="format-btn" title="Align Left">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M2 3h12v1H2V3zm0 3h8v1H2V6zm0 3h12v1H2V9zm0 3h8v1H2v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="alignCenterBtn" class="format-btn" title="Center">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M2 3h12v1H2V3zm2 3h8v1H4V6zm-2 3h12v1H2V9zm2 3h8v1H4v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="alignRightBtn" class="format-btn" title="Align Right">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M2 3h12v1H2V3zm4 3h8v1H6V6zm-4 3h12v1H2V9zm4 3h8v1H6v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="justifyBtn" class="format-btn" title="Justify">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M2 3h12v1H2V3zm0 3h12v1H2V6zm0 3h12v1H2V9zm0 3h12v1H2v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button id="bulletListBtn" class="format-btn list-btn" title="Bullet List">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <circle cx="3" cy="4" r="1" fill="currentColor"/>
                                <circle cx="3" cy="8" r="1" fill="currentColor"/>
                                <circle cx="3" cy="12" r="1" fill="currentColor"/>
                                <path d="M6 3.5h8v1H6v-1zm0 4h8v1H6v-1zm0 4h8v1H6v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="numberListBtn" class="format-btn list-btn" title="Numbered List">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M2 3.5v1h1v.5H2v1h2V4.5a.5.5 0 0 0-.5-.5H2zm0 4v.5h1v.5H2v1h2V7.5a.5.5 0 0 0-.5-.5H2zm0 4v1h2v-1H3v-.5h1v-1H2v.5h1v.5H2z" fill="currentColor"/>
                                <path d="M6 3.5h8v1H6v-1zm0 4h8v1H6v-1zm0 4h8v1H6v-1z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button id="clearFormatBtn" class="format-btn" title="Clear Formatting">
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
                    
                    <div 
                        id="textEditor" 
                        class="text-editor" 
                        contenteditable="true" 
                        spellcheck="false"
                        placeholder="Start typing or paste your lyrics/text here..."
                    ></div>
                </div>

                <div class="sidebar">
                    <h3>Annotations</h3>
                    <div id="annotationsList" class="annotations-list">
                        <p class="empty-state">No annotations yet. Select text and add context to get started!</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Context Popup -->
        <div id="contextPopup" class="context-popup">
            <div class="popup-header">
                <span class="popup-title">Add Context</span>
                <button id="closePopup" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <textarea 
                    id="contextInput" 
                    placeholder="Enter your context, explanation, or notes here..."
                    rows="4"
                ></textarea>
                <div class="popup-actions">
                    <button id="cancelContext" class="btn btn-secondary">Cancel</button>
                    <button id="saveContext" class="btn btn-primary">Save Context</button>
                </div>
            </div>
        </div>

        <!-- View Context Popup -->
        <div id="viewContextPopup" class="view-context-popup">
            <div class="popup-header">
                <span class="popup-title">Annotation Details</span>
                <button id="closeViewContext" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <div class="selected-text-container">
                    <strong>Selected Text:</strong>
                    <div id="viewSelectedText" class="selected-text"></div>
                </div>
                <div class="context-text-container">
                    <strong>Context:</strong>
                    <textarea id="viewContextText" class="context-text-editable" placeholder="Add your context here..."></textarea>
                </div>
                <div class="popup-actions">
                    <button id="deleteContextBtn" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>

        <!-- Login Popup -->
        <div id="loginPopup" class="auth-popup">
            <div class="popup-header">
                <span class="popup-title">Login to Your Account</span>
                <button id="closeLogin" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div class="popup-actions">
                        <button type="button" id="cancelLogin" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                </form>
                <p class="auth-switch">
                    Don't have an account? <a href="#" id="switchToRegister">Sign up here</a>
                </p>
            </div>
        </div>

        <!-- Register Popup -->
        <div id="registerPopup" class="auth-popup">
            <div class="popup-header">
                <span class="popup-title">Create Account</span>
                <button id="closeRegister" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" required minlength="6">
                        <div id="passwordMatchError" class="form-error" style="display: none;">
                            Passwords do not match
                        </div>
                    </div>
                    <div class="popup-actions">
                        <button type="button" id="cancelRegister" class="btn btn-secondary">Cancel</button>
                        <button type="submit" id="createAccountBtn" class="btn btn-accent">
                            <span class="btn-content">Create Account</span>
                        </button>
                    </div>
                </form>
                <p class="auth-switch">
                    Already have an account? <a href="#" id="switchToLogin">Login here</a>
                </p>
            </div>
        </div>

        <!-- Email Verification Popup -->
        <div id="emailVerificationPopup" class="auth-popup">
            <div class="popup-header">
                <span class="popup-title">üìß Check Your Email</span>
                <button id="closeEmailVerification" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <div style="text-align: center; padding: 1rem 0;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÆ</div>
                    <h3 style="margin-bottom: 1rem; color: #1e293b;">Almost there!</h3>
                    <p style="margin-bottom: 1.5rem; color: #64748b; line-height: 1.5;">
                        We've sent a verification link to:<br>
                        <strong id="verificationEmail" style="color: #3b82f6;"></strong>
                    </p>
                    <p style="margin-bottom: 1.5rem; color: #64748b; line-height: 1.5;">
                        Click the link in your email to verify your account and complete the registration process.
                    </p>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem; text-align: left;">
                        <p style="margin: 0; font-size: 0.875rem; color: #64748b;">
                            <strong>üí° Tip:</strong> Check your spam folder if you don't see the email within a few minutes.
                        </p>
                    </div>
                </div>
                <div class="popup-actions">
                    <button id="closeEmailVerificationBtn" class="btn btn-primary">Got it!</button>
                </div>
            </div>
        </div>

        <!-- New Document Popup -->
        <div id="newDocumentPopup" class="auth-popup">
            <div class="popup-header">
                <span class="popup-title">Create New Document</span>
                <button id="closeNewDocument" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <form id="newDocumentForm">
                    <div class="form-group">
                        <label for="newDocumentTitle">Document Title</label>
                        <input type="text" id="newDocumentTitle" required placeholder="Enter document title...">
                    </div>
                    <div class="popup-actions">
                        <button type="button" id="cancelNewDocument" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Document</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Account Side Panel -->
        <div id="accountPanel" class="account-panel">
            <div class="panel-header">
                <h3>Account</h3>
                <button id="closeAccountPanel" class="close-btn">&times;</button>
            </div>
            <div class="panel-content">
                <div class="user-section">
                    <div class="user-avatar">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <div class="user-details">
                        <div id="panelUserEmail" class="user-email"></div>
                        <div class="user-status">Signed in</div>
                    </div>
                </div>
                
                <div class="panel-options">
                    <div class="option-item">
                        <label class="option-label">
                            <div class="option-content">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
                                </svg>
                                <span>Dark Mode</span>
                            </div>
                            <div class="toggle-switch-wrapper">
                                <input type="checkbox" id="darkModeToggle" class="toggle-switch">
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>
                    

                    
                    <div class="option-item">
                        <button id="settingsBtn" class="option-button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                            </svg>
                            <span>Settings</span>
                        </button>
                    </div>
                    
                    <div class="option-item">
                        <button id="panelLogoutBtn" class="option-button logout-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                            </svg>
                            <span>Sign Out</span>
                        </button>
                    </div>
                    
                    <!-- Separator line -->
                    <div class="panel-separator"></div>
                    
                    <!-- Credits Content (always visible) -->
                    <div class="credits-content">
                        <div class="credits-info">
                            <h4>Developed by Sayre Alexander</h4>
                            <a href="https://github.com/Nuqb" target="_blank" rel="noopener noreferrer" class="github-link">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                My GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credits Panel -->
        <div id="creditsPanel" class="settings-panel">
            <div class="settings-header">
                <h3>Credits</h3>
                <button id="closeCredits" class="close-btn">&times;</button>
            </div>
            <div class="settings-content">
                <div class="settings-category">
                    <div style="text-align: center; padding: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #1e293b;">Developed by Sayre Alexander</h4>
                        <a href="https://github.com/Nuqb" target="_blank" rel="noopener noreferrer" 
                           style="display: inline-flex; align-items: center; gap: 0.5rem; color: #3b82f6; text-decoration: none; font-weight: 500;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                            GitHub Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-header">
                <h3>Settings</h3>
                <button id="closeSettings" class="close-btn">&times;</button>
            </div>
            <div class="settings-content">
                <div class="settings-category">
                    <h4>Annotation Settings</h4>
                    <div class="setting-item">
                        <label for="annotationStyle">Style:</label>
                        <select id="annotationStyle" class="setting-select">
                            <option value="highlight">Highlight</option>
                            <option value="underline">Underline</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="annotationColor">Color:</label>
                        <input type="color" id="annotationColor" class="setting-color" value="#fbbf24">
                    </div>
                    <div class="setting-item">
                        <label for="annotationTrigger">Show Details:</label>
                        <select id="annotationTrigger" class="setting-select">
                            <option value="click">On Click</option>
                            <option value="hover">On Hover</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="popupCloseMode">Close Popup:</label>
                        <select id="popupCloseMode" class="setting-select">
                            <option value="click-outside">X Button or Click Outside</option>
                            <option value="x-only">X Button Only</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button type="button" id="saveSettings" class="btn btn-primary">Save Settings</button>
                </div>
            </div>
        </div>

        <div id="overlay" class="overlay"></div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>